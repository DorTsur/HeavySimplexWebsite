---
layout: default
title: SimplexWater and HeavyWater
---

<section id="hero" style="text-align: center;">
  <h1 style="font-size: 2.8rem; margin: 2rem auto;">
    <code style="font-size: 2.8rem;">SimplexWater</code> and <code style="font-size: 2.8rem;">HeavyWater</code>:<br>
    <span style="font-size: 2.1rem; font-weight: normal;">Watermarking Low-Entropy Text Distributions</span>
  </h1>
  <p class="authors">
    <a href="https://sites.google.com/view/dortsur/home">Dor Tsur*</a>,
    <a href="https://carol-long.github.io/">Carol Xuan Long*</a>,
    <a href="https://claudioverdun.github.io/">Claudio Mayrink Verdun</a>,
    <a href="https://hsianghsu.github.io/">Hsian Hsu</a>,
    <a href="https://www.jpmorgan.com/technology/applied-research/richard-chen">Richard Chen</a>,
    <a href="https://www.ee.bgu.ac.il/~haimp/">Haim Permuter</a>,
    <a href="https://scholar.google.com/citations?user=_hSfZbMAAAAJ&hl=en">Sajani Vithana</a>,
    <a href="https://people.seas.harvard.edu/~flavio/">Flavio P. Calmon</a>
  </p>
  <div class="links">
    <a href="http://arxiv.org/abs/2506.06409" target="_blank">
      <img src="assets/images/arxiv_logo.jpeg" alt="arXiv" style="height: 60px;">
    </a>
    <a href="https://github.com/DorTsur/HeavyWater_SimplexWater" target="_blank">
      <img src="assets/images/github_logo.png" alt="GitHub" style="height: 60px;">
    </a>
  </div>
</section>

<img src="assets/images/system.png" alt="System Diagram" style="display: block; margin: 2rem auto; max-width: 700px;">

<div style="display: flex; justify-content: center; gap: 2rem; margin: 2rem 0;">
  <a href="#SimplexWater">
    <img src="assets/images/simplex.png" alt="SimplexWater" style="max-width: 150px; border-radius: 8px;">
  </a>
  <a href="#HeavyWater">
    <img src="assets/images/heavy.png" alt="HeavyWater" style="max-width: 150px; border-radius: 8px;">
  </a>
</div>

<section id="TL;DR">
  <h2 style="font-size: 2rem; margin: 2rem 0;">TL;DR</h2>
  <p class="highlight">Using coding theory, heavy tailed distributions and optimal transport, we propose two new watermarks and show their optimality; both theoretically and empirically.</p>
</section>

<section id="abstract">
  <h2 style="font-size: 2rem; margin: 2rem 0;">Abstract</h2>
  <p>Large language model (LLM) watermarks enable authentication of text provenance, curb misuse of machine-generated text, and promote trust in AI systems. Current watermarks operate by changing the next-token predictions output by an LLM. The updated (i.e., watermarked) predictions depend on random side information produced, for example, by hashing previously generated tokens. LLM watermarking is particularly challenging in low-entropy generation tasks—such as coding—where next-token predictions are near-deterministic. In this paper, we propose an optimization framework for watermark design. Our goal is to understand how to most effectively use random side information in order to maximize the likelihood of watermark detection and minimize the distortion of generated text. Our analysis informs the design of two new watermarks: HeavyWater and SimplexWater. Both watermarks are tunable, gracefully trading-off between detection accuracy and text distortion. They can also be applied to any LLM and are agnostic to side information generation. We examine the performance of HeavyWater and SimplexWater through several benchmarks, demonstrating that they can achieve high watermark detection accuracy with minimal compromise of text generation quality, particularly in the low-entropy regime. Our theoretical analysis also reveals surprising new connections between LLM watermarking and coding theory.</p>
</section>

<section id="Methodologies">
  <h2 style="font-size: 2rem; margin: 2rem 0;">Methods</h2>
  <h3 id="SimplexWater"><code>SimplexWater</code></h3>
  <p>For binary scores: We reformulate the watermark detection problem as a certain coding theory problem, and obtain an optimal watermark for binary scores.</p>
  
  <h3 id="HeavyWater"><code>HeavyWater</code></h3>
  <p>For continuous scores: We consider random scores and show that drawing scores from a heavy-tailed distribution increases detection. This method generalizes the Gumbel watermark.</p>
  
  <h3 id="Optimal Transport Driven Solution"><code>Optimal Transport</code></h3>
  <p>Given a score function and an LLM distribution, we formulate zero distortion watermarking as an optimal transport, which we efficiently solve with Sinkhorn's algorithm.</p>

  <h3 id="Distribution Tilting"><code>Distribution Tilting</code></h3>
  <p>Given a watermarked distribution, we can use the score function to further improve detection by rewighing it. The tilting procedure is given in a closed form. SimplexWater and HeavyWater differ by the exact tilting formula, but both follow a similar principle - Given side information s, increase the probability of tokens with score higher than the mean score.</p>

</section>

<section id="results" class="text-center">
  <h2 style="font-size: 2rem; margin: 2rem 0;">Results</h2>
  <div style="margin: 2rem 0; text-align: center;">
    <div style="margin: 2rem 0; font-size: 1.35rem; font-weight: 500;">Our watermarks achieve the best detection-distortion tradeoff</div>
    <img src="assets/images/tradeoff.png" alt="Tradeoff" style="max-width: 500px; border-radius: 8px;">
    
    <div style="margin: 2rem 0; font-size: 1.35rem; font-weight: 500;">Replacing the Red-Green watermark with ours can improve performance by up to 250% under various hashing schemes</div>
    <img src="assets/images/improvement.png" alt="Improvement" style="max-width: 500px; border-radius: 8px;">
    
    <div style="margin: 2rem 0; font-size: 1.35rem; font-weight: 500;">Our watermarks require the least tkens for detection</div>
    <img src="assets/images/watermark_Size.png" alt="Watermark Size" style="max-width: 500px; border-radius: 8px;">
  </div>
</section>

<section id="contact">
  <h2 style="font-size: 2rem; margin: 2rem 0;">Contacts</h2>
  <p>Dor Tsur <a href="mailto:dortsur93@gmail.com">dortsur93@gmail.com</a></p>
  <p>Carol Long <a href="mailto:carol_long@g.harvard.edu">carol_long@g.harvard.edu</a></p>
</section>
